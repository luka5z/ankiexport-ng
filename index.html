<!doctype html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Polyglot</title><link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3898/3898082.png"><link rel="manifest" href="manifest.json"><meta name="theme-color" content="#268bd2"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><style>:root{--sol-base03:#002b36;--sol-base02:#073642;--sol-base01:#586e75;--sol-base00:#657b83;--sol-base0:#839496;--sol-base1:#93a1a1;--sol-base2:#eee8d5;--sol-base3:#fdf6e3;--sol-yellow:#b58900;--sol-orange:#cb4b16;--sol-red:#dc322f;--sol-magenta:#d33682;--sol-violet:#6c71c4;--sol-blue:#268bd2;--sol-cyan:#2aa198;--sol-green:#859900;--bg:var(--sol-base3);--surface:var(--sol-base2);--text-main:var(--sol-base00);--text-muted:var(--sol-base01);--primary:var(--sol-blue);--secondary:var(--sol-green);--warning:var(--sol-yellow);--border:var(--sol-base1);--shadow:rgba(0, 0, 0, 0.05);--input-bg:#ffffff;--radius:8px}[data-theme=dark]{--bg:var(--sol-base03);--surface:var(--sol-base02);--text-main:var(--sol-base0);--text-muted:var(--sol-base1);--primary:var(--sol-blue);--border:var(--sol-base01);--shadow:rgba(0, 0, 0, 0.3);--input-bg:var(--sol-base03)}*{box-sizing:border-box}body{font-family:"Public Sans",Helvetica,Arial,sans-serif;background-color:var(--bg);color:var(--text-main);display:flex;justify-content:center;align-items:flex-start;min-height:100vh;margin:0;padding:1rem;transition:background-color .3s ease,color .3s ease}.container{background:var(--surface);width:100%;max-width:650px;padding:1.5rem;border-radius:var(--radius);box-shadow:0 4px 6px -1px var(--shadow);display:flex;flex-direction:column;margin-top:2vh;transition:background-color .3s ease,box-shadow .3s ease}.header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}h1{margin:0;color:var(--primary);font-size:1.75rem}.theme-toggle{background:0 0;border:none;color:var(--text-muted);font-size:1.2rem;cursor:pointer;padding:8px;border-radius:50%;transition:color .2s,background .2s}.theme-toggle:hover{color:var(--primary);background-color:rgba(0,0,0,.05)}.search-box{display:flex;gap:10px;margin-bottom:1rem}input{flex:1;padding:14px;font-size:16px;border:1px solid var(--border);border-radius:var(--radius);background-color:var(--input-bg);color:var(--text-main);-webkit-appearance:none;transition:border-color .2s}input:focus{outline:0;border-color:var(--primary)}button.action-btn{padding:12px 20px;color:#fff;border:none;border-radius:var(--radius);cursor:pointer;font-weight:600;font-size:1rem;transition:opacity .2s;touch-action:manipulation}button.action-btn:hover{opacity:.9}button.action-btn:active{transform:scale(.98)}button.action-btn:disabled{opacity:.5;cursor:not-allowed}#search-btn{background-color:var(--primary);min-width:60px}.btn-login{background-color:var(--primary);width:100%;margin-top:10px}.action-bar{display:none;gap:10px;margin-bottom:1.5rem;align-items:stretch;flex-wrap:wrap}.btn-export{background-color:var(--text-muted);flex:4;color:#fff}.btn-clear{background-color:var(--sol-red);flex:1;color:#fff}#cards-list{display:flex;flex-direction:column;gap:15px}.card-item{background-color:var(--input-bg);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:all .2s ease}.card-header{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;background-color:rgba(0,0,0,.02);border-bottom:1px solid transparent;cursor:pointer;user-select:none}.status-indicator{font-size:.9rem;margin-left:10px;display:inline-flex;align-items:center;gap:6px}.status-loading{color:var(--sol-blue)}.status-success{color:var(--sol-green)}.status-error{color:var(--sol-red)}.card-word-title{font-weight:700;font-size:1.1rem;color:var(--primary)}.card-controls{display:flex;gap:12px;align-items:center}.btn-icon{background:0 0;border:none;cursor:pointer;color:var(--text-muted);font-size:1rem;padding:4px;transition:color .2s}.btn-icon:hover{color:var(--sol-red)}.btn-expand{font-size:.9rem}.card-item.expanded{box-shadow:0 4px 6px -2px var(--shadow);border-color:var(--primary)}.card-item.expanded .card-header{border-bottom:1px solid var(--border);background-color:var(--surface)}.card-body{padding:15px;display:none}.card-item.expanded .card-body{display:block}.card-item.error-state{border-color:var(--sol-red);background-color:rgba(220,50,47,.05)}.card-item.error-state .card-header{background-color:rgba(220,50,47,.1)}.card-item.error-state .card-word-title{color:var(--sol-red);text-decoration:line-through}.anki-front,.definitions-content,.translate-div{font-family:"Souvenir Std",Georgia,serif}.anki-front{background-color:rgba(38,139,210,.08);border-left:4px solid var(--sol-blue);padding:15px;margin-bottom:15px;border-radius:4px}.pl-translation{background-color:rgba(108,113,196,.1);border-left:4px solid var(--sol-violet);padding:15px;margin-bottom:15px;border-radius:4px;font-size:1.1rem}.diki-label,.phonetic-label,.pl-label{font-weight:700;margin-right:8px;font-size:.8rem;text-transform:uppercase;letter-spacing:1px}.pl-label{color:var(--sol-violet)}.diki-label{color:var(--sol-cyan)}.phonetic-label{color:var(--sol-orange)}.pl-phonetic-text b{color:var(--sol-magenta);font-weight:900}.pl-phonetic-text{font-family:monospace}.definitions-content{background-color:rgba(133,153,0,.08);border-left:4px solid var(--sol-green);padding:15px;margin-bottom:15px;border-radius:4px}.editing-mode{background-color:rgba(181,137,0,.1)!important;border-left-color:var(--sol-yellow)!important;outline:0}.loader{width:10px;aspect-ratio:1;border-radius:50%;animation:l5 1s infinite linear alternate;margin:0 auto;display:block}@keyframes l5{0%{box-shadow:15px 0 #000,-15px 0 #0002;background:#000}33%{box-shadow:15px 0 #000,-15px 0 #0002;background:#0002}66%{box-shadow:15px 0 #0002,-15px 0 #000;background:#0002}100%{box-shadow:15px 0 #0002,-15px 0 #000;background:#000}}.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5);align-items:center;justify-content:center}.modal-content{background-color:var(--surface);margin:auto;padding:20px;border:1px solid var(--border);width:90%;max-width:400px;border-radius:var(--radius);position:relative;animation:fadeIn .2s;color:var(--text-main)}.close-modal-btn{color:var(--text-muted);float:right;font-size:24px;cursor:pointer}@keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.word-title{font-size:1.8rem;font-weight:700;margin:0}.phonetic{color:var(--text-muted);font-family:monospace;font-size:1.1rem}.part-of-speech{font-weight:700;font-style:italic;color:var(--surface);background:var(--text-muted);padding:2px 8px;border-radius:4px;font-size:.9rem}.pos-inline{font-style:italic;color:var(--sol-base01);font-size:.9rem}ul{margin:0;padding-left:1.2rem;margin-top:10px}li{margin-bottom:10px;line-height:1.6;color:var(--text-main)}.example{color:var(--text-muted);font-size:.9em;font-style:italic;display:block;margin-top:4px}.settings-toggle-btn{background:0 0;border:1px solid var(--border);color:var(--text-muted);border-radius:var(--radius);padding:6px 12px;cursor:pointer;font-size:.85rem;transition:all .2s}.settings-toggle-btn:hover{border-color:var(--primary);color:var(--primary)}.settings-toggle-btn:disabled{opacity:.5;cursor:not-allowed}#settings-panel{margin-top:1rem;padding:1rem;background-color:rgba(0,0,0,.03);border:1px solid var(--border);border-radius:var(--radius);display:none}#settings-panel input[type=number]{width:70px;padding:8px;margin-left:10px;flex:initial}.separator-select{padding:0 10px;border-radius:var(--radius);border:1px solid var(--border);background-color:var(--input-bg);color:var(--text-main);font-size:.9rem;min-width:80px}.switch{position:relative;display:inline-block;width:46px;height:24px;flex:initial}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--text-muted);transition:.4s;border-radius:24px}.slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#fff;transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--primary)}input:checked+.slider:before{transform:translateX(22px)}.view-hidden{display:none!important}@media (max-width:480px){body{padding:0;align-items:flex-start}.container{box-shadow:none;border-radius:0;padding:1rem;max-width:100%;min-height:100vh;margin-top:0}.action-bar{flex-direction:column;gap:12px}.separator-select,button.action-btn{width:100%;padding:14px}}</style></head><body><div id="login-view" class="container"><div class="header-row"><h1><i class="fas fa-lock"></i> Login</h1><button class="theme-toggle" onclick="toggleTheme()" id="login-theme-btn"><i class="fas fa-moon"></i></button></div><p style="color:var(--text-muted);margin-bottom:1rem">Please enter your API Token to access the dictionary.</p><input type="password" id="token-input" placeholder="Paste your Access Token..." onkeydown='"Enter"===event.key&&login()'> <button onclick="login()" class="action-btn btn-login">Unlock Dictionary</button></div><div id="app-view" class="container view-hidden"><div id="error-banner" class="error-banner" style="display:none"></div><div class="header-row"><h1><i class="fas fa-book-open"></i> Polyglot</h1><button class="theme-toggle" onclick="toggleTheme()" id="app-theme-btn"><i class="fas fa-moon"></i></button></div><div class="search-box"><input type="text" id="word-input" placeholder="Enter words (comma separated)..." autocomplete="off" onkeydown='"Enter"===event.key&&searchWord()'> <button onclick="searchWord()" id="search-btn" class="action-btn"><i class="fas fa-search"></i></button></div><div class="action-bar" id="action-bar"><button id="export-btn" class="action-btn btn-export" onclick="exportToAnki()"><i class="fas fa-download"></i> Export CSV</button> <button id="clear-btn" class="action-btn btn-clear" onclick="clearList()"><i class="fas fa-trash-alt"></i> Clear</button></div><div id="cards-list"></div><div id="stats-bar" style="margin-top:15px;font-size:.8rem;color:var(--text-muted);text-align:right;min-height:1.2em"></div><div style="display:flex;justify-content:space-between;border-top:1px solid var(--border);padding-top:10px;margin-top:20px"><button onclick="logout()" class="settings-toggle-btn" style="color:var(--sol-red);border-color:var(--sol-red)"><i class="fas fa-sign-out-alt"></i> Logout</button> <button class="settings-toggle-btn" onclick="toggleSettings()"><i class="fas fa-cog"></i> Settings</button></div><div id="settings-panel"><div style="display:flex;align-items:center;justify-content:space-between"><label for="setting-separator" style="color:var(--text-main);font-size:.9rem">CSV Separator:</label> <select id="setting-separator" class="separator-select" style="padding:5px"><option value=";" selected="selected">Semicolon (;)</option><option value=",">Comma (,)</option><option value="    ">Tab</option><option value="|">Pipe (|)</option></select></div><div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px"><label for="max-meanings" style="color:var(--text-main);font-size:.9rem">Max POS Groups:</label> <input type="number" id="max-meanings" value="3" min="1" max="10" onchange="updateSettings()"></div><div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px"><label for="max-defs" style="color:var(--text-main);font-size:.9rem">Max Definitions/Group:</label> <input type="number" id="max-defs" value="3" min="1" max="20" onchange="updateSettings()"></div><div style="display:flex;align-items:center;justify-content:space-between;margin-top:15px"><label for="auto-translate" style="color:var(--text-main);font-size:.9rem;cursor:pointer">Auto-Translate:</label> <label class="switch"><input type="checkbox" id="auto-translate" checked="checked" onchange="updateSettings()"> <span class="slider round"></span></label></div></div></div><div id="error-modal" class="modal"><div class="modal-content"><span class="close-modal-btn" onclick="closeModal()">&times;</span><div id="modal-message"></div></div></div><script>const API_BASE="https://iuy3bnzf16.execute-api.us-east-1.amazonaws.com",TOKEN_KEY="polyglot_api_token",SETTINGS_KEY="polyglot_max_meanings",SETTINGS_KEY_DEFS="polyglot_max_defs",AUTO_TRANS_KEY="polyglot_auto_translate",MAX_CONCURRENT_REQUESTS=2;let requestQueue=[],activeRequests=0,maxMeanings=3,maxDefs=3,autoTranslateEnabled=!0;function initAuth(){localStorage.getItem(TOKEN_KEY)?(showApp(),checkShareTarget()):showLogin()}function login(){const e=document.getElementById("token-input").value.trim();e&&(localStorage.setItem(TOKEN_KEY,e),showApp(),checkShareTarget())}function logout(){localStorage.removeItem(TOKEN_KEY),document.getElementById("word-input").value="",clearList(),closeModal(),showLogin()}function showApp(){document.getElementById("login-view").classList.add("view-hidden"),document.getElementById("app-view").classList.remove("view-hidden")}function showLogin(){document.getElementById("app-view").classList.add("view-hidden"),document.getElementById("login-view").classList.remove("view-hidden")}function checkShareTarget(){const e=new URLSearchParams(window.location.search),t=e.get("text")||e.get("w")||e.get("title");if(t){const e=decodeURIComponent(t).trim();if(e.length>0){document.getElementById("word-input").value=e,searchWord(),window.history.replaceState({},document.title,window.location.pathname)}}}function initSettings(){const e=localStorage.getItem(SETTINGS_KEY);e&&(maxMeanings=parseInt(e,10)),document.getElementById("max-meanings").value=maxMeanings;const t=localStorage.getItem(SETTINGS_KEY_DEFS);t&&(maxDefs=parseInt(t,10)),document.getElementById("max-defs").value=maxDefs;const n=localStorage.getItem(AUTO_TRANS_KEY);null!==n&&(autoTranslateEnabled="true"===n),document.getElementById("auto-translate").checked=autoTranslateEnabled}function toggleSettings(){const e=document.getElementById("settings-panel");e.style.display="block"===e.style.display?"none":"block"}function updateSettings(){maxMeanings=parseInt(document.getElementById("max-meanings").value,10),localStorage.setItem(SETTINGS_KEY,maxMeanings),maxDefs=parseInt(document.getElementById("max-defs").value,10),localStorage.setItem(SETTINGS_KEY_DEFS,maxDefs),autoTranslateEnabled=document.getElementById("auto-translate").checked,localStorage.setItem(AUTO_TRANS_KEY,autoTranslateEnabled)}function showModalError(e){const t=document.getElementById("error-modal"),n=document.getElementById("modal-message");t&&n&&(n.innerHTML=e,t.style.display="flex")}function closeModal(){const e=document.getElementById("error-modal");e&&(e.style.display="none")}function initTheme(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;setTheme("dark"===e||!e&&t?"dark":"light")}function toggleTheme(){setTheme("light"===document.documentElement.getAttribute("data-theme")?"dark":"light")}function setTheme(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e);const t="light"===e?'<i class="fas fa-moon"></i>':'<i class="fas fa-sun"></i>';document.getElementById("login-theme-btn").innerHTML=t,document.getElementById("app-theme-btn").innerHTML=t}function searchWord(){const e=document.getElementById("word-input"),t=(document.getElementById("cards-list"),e.value);if(!t.trim())return;document.getElementById("action-bar").style.display="flex";document.querySelectorAll(".card-item.expanded").forEach(e=>{e.classList.remove("expanded");const t=e.querySelector(".btn-expand i");t&&(t.classList.remove("fa-chevron-up"),t.classList.add("fa-chevron-down"))});t.split(/[\n,]+/).map(e=>e.trim()).filter(e=>e.length>0).reverse().forEach(e=>{spawnCard(e)}),e.value="",e.blur()}function spawnCard(e){const t=document.getElementById("cards-list"),n="card-"+Date.now()+"-"+Math.floor(1e3*Math.random()),a=`\n          <div class="card-item expanded" id="${n}">\n            <div class="card-header" onclick="toggleCard('${n}')">\n              <div style="display:flex; align-items:center;">\n                <span class="card-word-title">${e}</span>\n                <span class="status-indicator status-loading" id="${n}-status">\n                  <i class="fas fa-circle-notch fa-spin"></i>\n                </span>\n              </div>\n              <div class="card-controls">\n                 <button class="btn-icon btn-expand" id="${n}-toggle-icon">\n                    <i class="fas fa-chevron-up"></i>\n                 </button>\n                 <button class="btn-icon" onclick="removeCard(event, '${n}')">\n                    <i class="fas fa-times"></i>\n                 </button>\n              </div>\n            </div>\n\n            <div class="card-body">\n               <div class="anki-front">\n                  <div style="display:flex; justify-content:space-between; align-items:center;">\n                      <span class="word-title">${e}</span> \n                      <span class="phonetic"><div class="loader"></div></span>\n                  </div>\n               </div>\n               \n               <div class="anki-back">\n                  <div class="translate-div" style="display:none; margin-bottom: 20px;"></div>\n                  \n                  <div style="display:flex; gap: 10px; margin-bottom: 15px;">\n                      <button onclick="translateContext('${n}')" class="settings-toggle-btn trans-btn" style="flex:1; color: var(--sol-violet); border-color: var(--sol-violet);">\n                          <i class="fas fa-language"></i> Translate Context\n                      </button>\n                      <button onclick="toggleCardEdit('${n}')" class="settings-toggle-btn edit-btn" style="flex:1; color: var(--sol-yellow); border-color: var(--sol-yellow);">\n                          <i class="fas fa-pen"></i> Edit\n                      </button>\n                  </div>\n                  \n                  <div class="definitions-content">\n                      <div class="loader"></div>\n                  </div>\n               </div>\n            </div>\n          </div>\n        `;t.insertAdjacentHTML("afterbegin",a),queueFetch(n,e)}function toggleCard(e){const t=document.getElementById(e);if(!t)return;t.classList.toggle("expanded");const n=t.querySelector(".btn-expand i");t.classList.contains("expanded")?(n.classList.remove("fa-chevron-down"),n.classList.add("fa-chevron-up")):(n.classList.remove("fa-chevron-up"),n.classList.add("fa-chevron-down"))}function removeCard(e,t){e.stopPropagation();const n=document.getElementById(t);n&&(n.remove(),updateTotalStats(),0===document.getElementById("cards-list").children.length&&(document.getElementById("action-bar").style.display="none"))}function markCardError(e,t){const n=document.getElementById(e);if(!n)return;n.classList.add("error-state");const a=document.getElementById(`${e}-status`);a&&(a.innerHTML='<i class="fas fa-times-circle"></i>',a.className="status-indicator status-error");const o=n.querySelector(".definitions-content");o&&(o.innerHTML=`<em>${t}</em>`);const s=n.querySelector(".phonetic");s&&(s.innerHTML="")}async function fetchWithBackoff(e,t,n=5,a=1e3){try{const o=await fetch(e,t);return(429===o.status||503===o.status)&&n>0?(await new Promise(e=>setTimeout(e,a)),fetchWithBackoff(e,t,n-1,2*a)):o}catch(e){throw e}}function queueFetch(e,t){requestQueue.push({cardId:e,word:t}),processQueue()}async function processQueue(){if(0===requestQueue.length||activeRequests>=2)return;const{cardId:e,word:t}=requestQueue.shift();activeRequests++;try{await fetchCardData(e,t)}catch(e){console.error("Queue process error:",e)}finally{activeRequests--,processQueue()}}async function fetchCardData(e,t){const n=localStorage.getItem(TOKEN_KEY),a=document.getElementById(e);if(!a)return;const o=a.querySelector(".definitions-content"),s=a.querySelector(".phonetic"),i=document.getElementById(`${e}-status`),r=(async()=>{try{const e=await fetch(`${API_BASE}/dictionary`,{method:"POST",headers:{"Content-Type":"application/json","x-api-token":n},body:JSON.stringify({word:t})});if(!e.ok)throw new Error("API Error");return await e.json()}catch(e){return{error:"Fetch Failed",details:e}}})(),l=autoTranslateEnabled?fetchTranslate(t,n):Promise.resolve(null);try{const[t,n]=await Promise.all([r,l]);if(t.error||!t.meanings&&!t.phonetic){if(!n||!n.translation)return markCardError(e,"No definition found or Network Error."),void updateTotalStats();o.innerHTML="<em>No definitions found in dictionary.</em>",i.innerHTML='<i class="fas fa-exclamation-circle"></i>',i.className="status-indicator status-error"}else{const e=t.phonetic||t.phonetics&&t.phonetics.find(e=>e.text)?.text||"";e?s.innerText=e:s.querySelector(".loader")&&(s.innerText=""),o.innerHTML=generateDefinitionsHtml(t.meanings),i.innerHTML='<i class="fas fa-check"></i>',i.className="status-indicator status-success"}if(n){!n.ipa||s.innerText&&""!==s.innerText||(s.innerText=n.ipa);const e=a.querySelector(".translate-div"),t=generateTranslationHtml(n);t?(e.innerHTML=t,e.classList.add("pl-translation"),e.style.display="block"):e.style.display="none"}else if(autoTranslateEnabled){a.querySelector(".translate-div").style.display="none"}s.querySelector(".loader")&&(s.innerText="")}catch(t){console.error("Critical Fetch Error:",t),markCardError(e,"Network or Server Error")}updateTotalStats()}async function fetchTranslate(e,t){try{const n=await fetchWithBackoff(`${API_BASE}/translate`,{method:"POST",headers:{"Content-Type":"application/json","x-api-token":t},body:JSON.stringify({word:e})});return n.ok?await n.json():null}catch(e){return null}}function generateDefinitionsHtml(e){if(!e)return"";let t="";return e.slice(0,maxMeanings).forEach(e=>{const n=e.definitions.slice(0,maxDefs);t+=`\n                <div class="meaning-group" style="margin-bottom: 1.5rem;">\n                    <span class="part-of-speech">${e.partOfSpeech}</span>\n                    <ul>\n                        ${n.map(e=>`\n                            <li>\n                                ${e.definition}\n                                ${e.example?`<br><span class="example">"${e.example}"</span>`:""}\n                            </li>\n                        `).join("")}\n                    </ul>\n                </div><br>\n            `}),t}function generateTranslationHtml(e){let t="";if(e.translation&&(t+=`<div><span class="pl-label">TRANSLATE</span> ${e.translation}</div>`),e.phonetic_pl){t+=`<div style="margin-top:4px;"><span class="phonetic-label">PHONETIC</span> <span class="pl-phonetic-text">[${e.phonetic_pl.replace(/([A-ZĄĆĘŁŃÓŚŹŻ]+)/g,"<b>$1</b>")}]</span></div>`}if(e.meanings&&e.meanings.length>0){t+=`<div style="margin-top:8px;"><span class="diki-label">WEB</span> ${e.meanings.map(e=>{const t=e.definitions.join(", ");return e.part_of_speech&&"unknown"!==e.part_of_speech?`<span class="pos-inline">${e.part_of_speech}</span>: ${t}`:t}).join("; ")}</div>`}return t}function toggleCardEdit(e){const t=document.getElementById(e),n=t.querySelector(".definitions-content"),a=t.querySelector(".edit-btn");n.isContentEditable?(n.contentEditable="false",n.classList.remove("editing-mode"),a.innerHTML='<i class="fas fa-pen"></i> Edit'):(n.contentEditable="true",n.classList.add("editing-mode"),n.focus(),a.innerHTML='<i class="fas fa-save"></i> Save')}async function translateContext(e){const t=document.getElementById(e),n=t.querySelector(".definitions-content"),a=t.querySelector(".trans-btn"),o=t.querySelector(".word-title").innerText;if(n.classList.contains("pl-translation"))return;const s=`<div class="word-title">${o}</div><br>${n.innerHTML}`,i=localStorage.getItem(TOKEN_KEY),r=n.innerHTML;n.innerHTML='<div class="loader"></div>',a.disabled=!0;try{const e=await fetchWithBackoff(`${API_BASE}/translate`,{method:"POST",headers:{"Content-Type":"application/json","x-api-token":i},body:JSON.stringify({word:s})});if(!e.ok)throw new Error("Translation failed");const t=await e.json();t.translation?(n.innerHTML=t.translation,n.classList.add("pl-translation"),n.style.backgroundColor="rgba(108, 113, 196, 0.1)",n.style.borderLeftColor="var(--sol-violet)"):(n.innerHTML=r,showModalError("No translation returned."))}catch(e){n.innerHTML=r,showModalError("Context translation failed.")}finally{a.disabled=!1}}function updateTotalStats(){const e=document.querySelectorAll(".card-item");let t=0;e.forEach(e=>{const n=e.querySelector(".anki-front")?.innerText||"",a=e.querySelector(".translate-div")?.innerText||"",o=e.querySelector(".definitions-content")?.innerText||"";t+=n.length+a.length+o.length});const n=document.getElementById("stats-bar");e.length>0?n.innerHTML=`Cards: <b>${e.length}</b> | Total Chars (approx): <b>${t}</b>`:n.innerHTML=""}function clearList(){document.getElementById("cards-list").innerHTML="",document.getElementById("stats-bar").innerHTML="",document.getElementById("action-bar").style.display="none"}function exportToAnki(){const e=document.querySelectorAll(".card-item");if(0===e.length)return void alert("No cards to export.");const t=document.getElementById("setting-separator").value;let n="";e.forEach(e=>{const a=e.querySelector(".anki-front"),o=e.querySelector(".translate-div"),s=e.querySelector(".definitions-content");let i=a.innerHTML.replace(/\n/g,"").trim(),r="";if(o&&"none"!==o.style.display){const e=o.cloneNode(!0),t=e.querySelector(".pl-phonetic-text");t&&(i+=`<br><span class="pl-phonetic-text" style="font-size:0.95rem; color:var(--sol-base01); font-family:monospace;">${t.innerHTML}</span>`,t.parentElement.remove()),e.innerText.trim().length>0&&(r+=e.outerHTML)}r+=s.outerHTML,i=i.replace(/\n/g,"").replace(/<hr[^>]*>/g,"").trim(),r=r.replace(/\n/g,"").trim(),r=r.replace(/<span class="(pl-label|diki-label|phonetic-label)">.*?<\/span>/g,""),n+=`"${escapeCsv(i)}"${t}"${escapeCsv(r)}"\n`});const a=`polyglot_export_${(new Date).toISOString().slice(0,10)}.csv`;downloadFile(n,a),clearList()}function escapeCsv(e){return e?e.replace(/"/g,'""'):""}function downloadFile(e,t){const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(n),o=document.createElement("a");o.setAttribute("href",a),o.setAttribute("download",t),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}window.onclick=function(e){const t=document.getElementById("error-modal");e.target==t&&(t.style.display="none")},initTheme(),initSettings(),initAuth()</script></body></html>